## 功能相关

**1.业务量临时突增，如何变更集群配置，来保证业务正常进行**</br>

在业务量临时突增的情况下，建议您先进行节点扩容，之后再进行节点数量缩容。集群数据节点扩缩容都需要重启集群才能生效，在重启前，请注意：</br>
- 确保实例的状态为正常（绿色）。</br>
- 索引至少包含1个副本、 资源使用率不是很高（可在集群监控页面查看，例如节点CPU使用率为80%左右，节点HeapMemory使用率为50%左右）。</br>

**2.云搜索Elasticsearch是否支持logstash对接**</br>

支持Logstash对接，Logstash版本建议与Elasticsearch版本保持一致，且用户需要申请一台云主机来安装Logstash并进行配置。</br>

**3.主节点、数据节点、专用主节点、协调节点的区别是什么**</br>

 - **主节点**：主要职责是和集群操作相关的内容，如创建或删除索引，跟踪哪些节点是群集的一部分，并决定哪些分片分配给相关的节点。默认情况下任何一个集群中的节点都有可能被选为主节点，索引数据和搜索查询等操作会占用大量的cpu，内存，io资源，为了确保一个集群的稳定，分离主节点和数据节点是一个比较好的选择。</br>
 - **数据节点**： 主要是存储索引数据的节点，主要对文档进行增删改查操作，聚合操作等。数据节点对cpu，内存，io要求较高，在优化的时候需要监控数据节点的状态，当资源不够的时候，需要在集群中添加新的节点。</br>
 - **专用主节点**：用来执行集群的管理任务，包括跟踪群集中的所有节点、跟踪群集中的索引数量、跟踪属于每个索引的分片数量、维护群集中节点的路由信息、在状态更新后更新群集状态等，但不保留数据也不响应数据上传请求，用来提升集群稳定性。</br>
 - **协调节点**： 类似于负载均衡器，用来处理路由请求，处理搜索，分发索引操作等。</br>
 
 **4.集群有绿色、黄色、红色状态，分别代表什么**</br>
 
其中健康状态是Elasticsearch集群非常重要的监控项，用来表征集群总体上是否工作正常。健康状态种类如下：</br>

* 绿色（green）：在云监控的集群状态中用0表示，表示所有的主分片和副本分片都已分配，集群是100%可用的，此时集群处于最健康的状态。 </br>
* 黄色（yellow）： 在云监控的集群状态中用1表示，表示所有的主分片已经分片了，但至少有一个副本是缺失的，高可用性在某种程度上被弱化，但是数据检索的结果仍然可以正常返回。 </br>
* 红色（red）： 在云监控的集群状态中用2表示，表示至少有一个主分片（以及它的全部副本）都在缺失中，此时查询结果会有确实，集群出现问题。 </br>

**5.当集群为red或yellow的时候怎么办**</br>

集群为RED表示集群中有primary shard没有分配，yellow表示有replica没有分配，我们建议你用下面这个API来看shard为什么没有被分配到某个节点上。</br>
```
GET _cluster/allocation/explain
```
根据我们的使用经验，有以下几种情况导致shard没有被分配：</br>
- 没有节点上有存储空间能够放下这个shard。</br>
- 如果shard是replica，那么可能是primary shard未分配或者处于initializing状态。</br>

**6.一部分节点的CPU和负载正常，另一部分处于空闲状态，如何处理**</br>

此现象是集群负载不均问题引起的。导致ES集群负载不均问题的原因很多，目前主要包括shard设置不合理、segment大小不均造成的。</br>

**7.变更集群配置会影响ES服务吗**</br>

变更集群配置会导致集群重启。目前ES集群重启是采用滚动重启的方式，在集群状态正常（绿色）、索引至少包含1个副本的情况下，如果资源使用率也不是特别高（可在集群监控页面查看，例如节点CPU使用率为80%左右，节点HeapMemory使用率为50%左右），那么集群在重启期间能够持续提供服务，但建议在业务低峰期进行操作。</br>





