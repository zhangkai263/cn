# 常见问题
- [三种负载均衡类型，如何选择使用哪一种](FAQ#user-content-1)
- [后端服务器健康检查异常](FAQ#user-content-2)
- [应用负载均衡HTTP/HTTPS协议下监听无法获取客户端真实IP](FAQ#user-content-3)
- [多可用区是怎样保障高可用的](FAQ#user-content-4)
- [应用负载均衡后端服务如何选择关联虚拟服务器组还是高可用组](FAQ#user-content-5)
- [一个应用负载均衡实例占用的内网ip资源](FAQ#user-content-6)
- [配置转发规则组时，未配置重定向规则，为什么负载均衡会对某些请求的URL进行重定向](FAQ#user-content-8)

-----------------------------------------------------------------------------------------------------

**Q：三种负载均衡类型，如何选择使用哪一种？**
<div id="user-content-1"></div>

A：在满足用户需求的同时，建议按照如下流程选择负载均衡类型，以使用户获得最好的性能体验及花费最少。
![LB类型选择](../../../../image/Networking/ALB/ALB-faq.png)

**Q：后端服务器健康检查异常**
<div id="user-content-2"></div>

【问题描述】
负载均衡仅向健康检查状态正常的后端服务器上转发业务流量。当检查健康检查异常时，负载均衡将不向该后端服务器转发业务流量。

【原因及解决方案】
后端服务器健康检查失败的原因主要有如下几个：

- 后端服务没有绑定监听器或转发规则组：负载均衡不对未绑定监听器或转发规则组的后端服务进行健康检查，后端服务中所有后端服务器的健康检查状态为异常。解决方案，将后端服务绑定监听器或转发规则组
- 负载均衡与后端服务器网络不通：检查负载均衡绑定的安全组、后端服务器绑定的安全组、网络ACL、后端服务器上的安全类防护软件是否放行了负载均衡的健康检查流量及与后端服务的业务流量
- 健康检查端口或其他参数配置错误：检查健康检查端口（如果不配置，默认为后端服务器提供服务的端口）、检查域名、检查路径、正常态码等是否配置正确
- 后端服务器上服务未开启：检查在不通过负载均衡，直接访问后端服务器指定路径或指定端口的服务是否可通

**Q：应用负载均衡HTTP/HTTPS协议下监听无法获取客户端真实IP**
<div id="user-content-3"></div>

A：应用负载均衡默认支持HTTP/HTTPS协议下获取客户端真实IP，需用户在web server中进行相应的配置。

以nginx为例：需要安装http_realip module，并在nginx.conf中添加以下两行配置项：

set_real_ip_from 应用负载均衡所在子网IP段

real_ip_header X-Forwarded-For

![nginx XFF配置](https://github.com/jdcloudcom/cn/blob/master/image/Networking/ALB/ALB-010.png)

**Q：多可用区是怎样保障高可用的？**
<div id="user-content-4"></div>

A：只能将应用负载均衡所在可用区内的云主机/容器添加为后端服务，按照设置的调度算法进行流量转发，当一个可用区出现故障时，流量将自动切换至其他可用区服务器。


**Q：应用负载均衡后端服务如何选择关联虚拟服务器组还是高可用组？**
<div id="user-content-5"></div>

A：虚拟服务器组可以由用户手动或者通过与AS关联自动增删云主机实例，手动配置方式使用简单；虚拟服务器组可以与AS（弹性伸缩）关联使用，实现跨可用区的高可用，但不保证同可用区内跨机架的高可用。高可用组自动实现了主机实例跨AZ、跨机架的高可用分配与按照规则弹性伸缩，提供比虚拟服务器组更灵活、更自动的主机分配服务。因此用户需要简单使用、快速上手时，可选择关联虚拟服务器组；用户需要自动的高可用服务，建议选择关联高可用组。


**Q：一个应用负载均衡实例占用的内网ip资源？**
<div id="user-content-6"></div>

A：应用负载均衡在每个可用区采用高可用架构，默认启用两个实例资源，除去vip还需要占用两个所在子网的ip资源，因此单可用区一共会占用3个内网ip，双可用区会占用5个内网ip，每多支持一个可用区需多占用两个所在子网的ip资源，以此类推。

**Q：应用负载均衡性能说明**
<div id="user-content-7"></div>

A：不同业务场景下，应用负载均衡的性能指标不同，默认情况下单可用区应用负载均衡实例性能指标如下：
- HTTP长连接：负载均衡实例可处理QPS达2万左后
- HTTP短连接：负载均衡实例可处理QPS达2万左右
- HTTPS长连接：负载均衡实例可处理QPS达2万左右
- HTTPS短连接：负载均衡实例可处理QPS达1000左右
- TCP长连接：负载均衡实例可处理QPS达5万左右
- TCP短连接：负载均衡实例可处理QPS达2万左右
- TLS长连接：负载均衡实例可处理QPS达2万左右
- TLS短连接：负载均衡实例可处理QPS达1000左右
默认情况下，两个可用区负载均衡性能是单可用区负载均衡性能的2倍。以上性能指标仅供参看，可能因实际业务情况不同性能略有差异，请以实际情况为准。如评估性能不能满足业务需求，可工单或电话联系京东云工程师进行扩容。


**Q：配置转发规则组时，未配置重定向规则，为什么负载均衡会对某些请求的URL进行重定向？**
<div id="user-content-8"></div>

A：当应用负载均衡配置的转发规则的URL路径以'/'结尾，并且相同域名下未配置另外一条相同URL路径前缀但没有'/'的转发规则时，应用负载均衡会对访问没有'/'的URL路径前缀的请求执行301重定向，返回带'/'的URL请求，以实现带'/'和不带'/'的访问请求都可以被应用负载均衡兼容转发。

举例1：应用负载均衡配置了转发规则1(域名:aaa. bbb. com ，URL路径：/path1/abc/或/path/abc/\*，后端服务：backend)，未配置转发规则2(域名：aaa. bbb. com ，URL 路径： /path/abc，后端服务：backend)。用户访问 http:// aaa. bbb . com/path1/abc ，应用负载均衡收到访问请求时，会执行301重定向返回http:// aaa. bbb. com/path1/abc/ ，访问流量将匹配转发规则1分发给backend处理。

如用户不想应用负载均衡执行301重定向，可配置转发规则2（域名：aaa. bbb. com ，URL路径：/path1/abc，后端服务：backend），通过该转发规则明确指定访问请求http:// aaa. bbb. com/path1/abc 的转发行为。

