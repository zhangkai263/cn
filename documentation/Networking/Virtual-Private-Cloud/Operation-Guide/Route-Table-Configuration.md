# 路由表配置
本文将详细介绍如何在京东云配置路由表，具体包括如下操作：

- [创建路由表](route-table-configuration#user-content-1)
- [配置路由策略](route-table-configuration#user-content-2)
- [配置路由传播](route-table-configuration#user-content-3)
- [关联子网](route-table-configuration#user-content-4)
- [修改路由表](route-table-configuration#user-content-5)
- [更换路由表](route-table-configuration#user-content-6)
- [删除路由表](route-table-configuration#user-content-7)

## 操作背景

- 打通网络连接，配置路由策略；
- 更改网络配置，更改路由策略。

## 前提条件及限制

- 确保您已经[注册京东云账号](https://user.jdcloud.com/register?returnUrl=https%3A%2F%2Fwww.jdcloud.com%2F)，并实现[实名认证](https://docs.jdcloud.com/cn/real-name-verification/introduction)；
- 确保您已创建了一个私有网络(VPC)；

- 每个子网必须关联一张路由表，每张路由表可以关联多个子网；
- 默认路由表及已经关联了子网的自定义路由表不支持删除；
- 默认 Local 路由规则不可编辑、不可删除；
- 不支持动态路由协议。
- 默认路由表，创建私有网络时，默认会创建一张默认路由表，包含两条默认的路由规则，分别为私有网络内部通信的Local和访问公网的Internet网关。Local路由不能修改、不能删除，其具体规则为[Local Local Local]，Internet路由可以修改、可以删除；

- 自定义路由表，用户创建的路由表为自定义路由表，包含一条默认的路由规则，为私有网络内部通信的Local，不能修改、不能删除；

- 私有网络内的子网之间进行通信，优先匹配Local路由；

- 路由表的路由规则匹配顺序为local、路由前缀掩码从长到短的精确匹配、0.0.0.0/0最后匹配；路由前缀与掩码长度一样时，静态路由优先、传播路由其次，同为传播路由则为等价路由；

### 创建路由表

<div id="user-content-1"> </div>

```
您创建的路由表即为自定义路由表，支持删除，默认路由表由系统创建，不支持删除，随VPC删除而删除。
```
步骤1：打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：选择创建路由表所属地域，点击【创建】按钮，进入路由表创建页面；
```
注：地域可在创建弹窗中进行更改，资源创建完成后，地域不可更改。
```
步骤3：补充相关信息，各个配置项说明如下：

|配置名称   |说明|示例|   
|-----------|----|------|
|地域|选择地域，选择路由表所属VPC所在的地域，全地域支持创建路由表|华北-北京|
|私有网络|选择路由表所属的VPC|vpc-xx|
|名称|设置路由表名称：名称不可为空，只支持中文、数字、大小写字母、英文下划线“_”及中划线“-”，且不能超过32字符|路由表-1|
|描述|设置路由表描述：描述可以为空，只支持中文、数字、大小写字母、英文下划线“_”，且不能超过256字符|子网1的路由表|
      
      注：双栈私有网络支持创建IPv6的路由表

步骤4：点击【确定】后即可进入【控制台】查看创建的路由表；

步骤6：创建路由表后，可进行路由规则配置，也可稍后进入详情页自行配置；


### 配置路由策略

<div id="user-content-2"> </div>

配置路由策略，包括新增、修改、删除路由策略，详细步骤如下：

**新增路由策略**

步骤1：打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：定位需要配置路由规则的路由表，点击路由表名称进入路由表详情页，点击路由策略进入路由规则页签，点击【编辑】按钮，管理路由表规则；

步骤3：点击【新增一条】添加路由策略；补充相应的配置项，各个配置项说明如下：

|配置名称   |说明|示例|   
|-----------|----|------|
|目的端|输入要转发到的目标网段，目的端输入格式为网段的CIDR，如需输入指定地址，IPv4地址输入：x.x.x.x/32，IPv6地址输入：xxxx::/128|10.0.0.0/16|
|下一跳类型|选择将目的地址在目的端范围内的流量的下一跳类型，支持Internet、云主机、边界网关、VPC对等连接、NAT网关;其中IPv6路由策略的下一跳类型支持云主机、VPC对等连接和Internet；流量若要访问Internet，可选择Internet网关，或自建云主机作为公网网关；nternet|
|下一跳 |根据下一跳类型为将目的地址在目的端范围内的流量选择某个具体的下一跳|internet|
|路由类型|默认为静态|静态|
|备注|用于区分说明路由策略的用途|路由至公网|


```
注：
1. 路由策略目的端不能完全相同，如须配置相同目的端，可申请ECMP功能权限，目前ECMP处于灰度测试中；
2. 若路由表所在的私有网络有预设CIDR，则路由规则的目的端不能与所属私有网络的CIDR有冲突；
3. 若路由表所在的私有网络无预设CIDR，则路由规则的目的端不能与所属私有网络中的任何子网的CIDR有冲突；
```
步骤4：补充完相关信息后，点击【保存】后即可完成新增路由策略；

**修改路由策略**

步骤1：打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：定位需要修改路由策略的路由表，点击路由表名称进入路由表详情页，点击路由策略进入路由规则页签，点击【编辑】按钮，管理路由表规则；

步骤3：定位需要修改的路由策略，更改对应的配置项；

步骤4：点击【保存】后即可完成更新路由策略。

**删除路由策略**

步骤1：打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：定位需要修改路由策略的路由表，点击路由表名称进入路由表详情页，点击路由策略进入路由规则页签，点击【编辑】按钮，管理路由表规则；

步骤3：定位需要删除的路由策略；

步骤4：点击【保存】后即可完成删除路由策略。

### 配置路由传播

<div id="user-content-3"> </div>

步骤1：打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：点击路由表名称进入路由表详情页，点击路由传播页签，进入路由传播规则列表页面；

步骤3：点击添加进行路由传播信息的填写，一个VPC可以同时与多个边界网关建立路由传播关系；

步骤4：在添加路由传播对话框内：边界网关，选择向VPC传播路由的源边界网关；

步骤5：在添加路由传播对话框内：路由传播范围，指从边界网关传播到VPC的路由前缀CIDR地址范围；支持输入多个CIDR范围，多个之间以英文逗号分隔。配置传播路由后，将自动将所选边界网关中该网段及其子网段的路由传播到此路由表。支持配置传播0.0.0.0/0路由，此时将传播所选边界网关中的全部有效路由；

步骤6：点击【确定】。配置生效后，系统将从边界网关有效路由表中选择路由前缀在传播范围内的路由规则（包括静态和动态路由），自动添加VPC路由表内，下一跳类型为边界网关、下一跳指向“路由传播”配置中指定的边界网关名称、路由类型为传播。传播路由可查看，不可编辑。



### 关联子网

<div id="user-content-4"> </div>

步骤1：登录京东云，打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；

步骤2：在操作栏下点击【关联子网】，或者点击路由表名称进入路由表详情页、点击关联子网页签的【关联子网】按钮；

步骤3：在弹出的子网选择页面，选择要关联该路由表的子网，可将该路由表关联至同私有网络下的子网；

步骤4：点击【确定】后即可将路由表关联至子网；

```
注：
1）路由表只能关联相同属性的子网；
2）相同属性子网包含两种情况：a.相同地域的标准子网，b.相同地域关联相同边缘可用区的边缘子网；
3）已关联标准子网的路由表，不能再关联边缘子网，已关联边缘子网的路由表，不能再关联标准子网，也不能关联不同边缘可用区的边缘子网；
4）如需配置支持IPv6的路由策略，须选择支持IPv6的VPC。
```


### 修改路由表

<div id="user-content-5"> </div>

步骤1：登录京东云，打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；
   
步骤2：定位需要修改的路由表，点击路由表名称进入详情页；

步骤3：点击名称/描述后的修改图标，即可对路由表名称/描述进行修改，具体的名称/描述规则参见路由表创建；

步骤4：输入修改后的内容，点击【确认】按钮完成内容修改。

### 更换路由表

<div id="user-content-6"> </div>

步骤1：登录京东云，打开控制台，选择 网络 -> 【私有网络】 -> 【路由表】，进入路由表列表页；
   
步骤2：定位需要更换子网的路由表，点击路由表名称进入详情页，选择关联子网tab；

步骤3：定位需要更换路由表的子网，于操作列点击【更换路由】，选择需要更换路由表；

步骤4：点击【确定】，完成子网更换路由表。

在子网侧也可进行更换路由操作，具体操作如下：

步骤1：登录京东云，打开控制台，选择 网络 -> 【私有网络】 -> 【子网】，进入子网列表页；

步骤2：定位需要更换路由表的子网，点击子网名称进入详情页，选择路由规则tab；

步骤3：点击【更换路由表】，选择新的路由表；

步骤4：点击【确定】，完成从子网侧更换路由表。

### 删除路由表

<div id="user-content-7"> </div>

步骤1：打开控制台，选择 网络 > 私有网络 > 路由表 ，进入路由表列表页；
  
步骤2：点击操作列的删除；

步骤3：二次确认删除路由表后，即可删除该路由表；
  
```
注：
1. 关联了子网的自定义路由表不可删除；
2. 默认路由表不可删除。
```



